{"version":3,"sources":["apis/contractHelps/tokenContract.js","apis/contractHelps/institutionContract.js","apis/helpers/web3Helpers.js","apis/helpers/getWeb3.js"],"names":["tokenContract","_tokenContract","apply","this","arguments","_callee","contract","_ref","currentProvider","accounts","D_workspace_web3game_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","wrap","_context","prev","next","TruffleContract","TokenContract","getProviderAndAccounts","sent","setProvider","defaults","from","abrupt","deployed","stop","getTokenBalance","_getTokenBalance","_callee2","_context2","getAccounts","balanceOf","buyScroll","_x","_x2","_buyScroll","_callee3","scrollType","price","institution","_context3","institutionContract","address","web3","toWei","bet","_x3","_x4","_x5","_x6","_x7","_x8","_bet","_callee4","betAddress","betType","value","issueNo","nums","amounts","_context4","transfer","_x9","_transfer","_callee5","transferParam","_ref2","transactionObject","_context5","getWeb3","type","to","toAccount","amount","sendTransaction","_institutionContract","InstitutionContract","batchDrawStaticProfit","_batchDrawStaticProfit","releaseScroll","_releaseScroll","task","id","renewScroll","_renewScroll","_getAccounts","eth","getAccountsAsync","promisify","getBalance","_getBalance","getBalanceAsync","_getProviderAndAccounts","_ref3","_sendTransaction","_ref5","sendTransactionAsync","web3Instance","Object","D_workspace_web3game_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","mark","context","web3Provider","window","global","ethereum","enable","t0","Error","console","log","Web3","providers","HttpProvider","getLang","WEB3","NO_WEB3_PROVIDER"],"mappings":"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","file":"static/js/3.32be79ec.chunk.js","sourcesContent":["import TruffleContract from 'truffle-contract';\r\n\r\nimport TokenContract from '../contracts/CupcakeToken.json';\r\nimport { getProviderAndAccounts, getAccounts, sendTransaction } from '../helpers/web3Helpers';\r\nimport { institutionContract } from './institutionContract';\r\nimport { getWeb3 } from \"../helpers/getWeb3\";\r\n\r\nexport async function tokenContract() {\r\n    const contract = TruffleContract(TokenContract);\r\n    const { currentProvider, accounts } = await getProviderAndAccounts();\r\n    contract.setProvider(currentProvider);\r\n    contract.defaults({from: accounts[0]});\r\n    return contract.deployed();\r\n}\r\n\r\nexport async function getTokenBalance() {\r\n    const accounts = await getAccounts();\r\n    const contract = await tokenContract();\r\n    return contract.balanceOf(accounts[0]);\r\n}\r\n\r\nexport async function buyScroll(scrollType, price) {\r\n    const contract = await tokenContract();\r\n    const institution = await institutionContract();\r\n    return contract.buyScroll(institution.address, scrollType, web3.toWei(price, 'ether'), 1, web3.toWei(price, 'ether'));\r\n}\r\n\r\nexport async function bet(betAddress, betType, value, issueNo, nums, amounts) {\r\n    const contract = await tokenContract();\r\n    const institution = await institutionContract();\r\n    return contract.bet(\r\n        betAddress, \r\n        institution.address, \r\n        betType, \r\n        value, \r\n        issueNo, \r\n        nums, \r\n        amounts,\r\n    );\r\n}\r\n\r\nexport async function transfer(transferParam) {\r\n    const web3 = await getWeb3();\r\n    const { accounts } = await getProviderAndAccounts();\r\n    if(transferParam.type === 'TT') {\r\n        var transactionObject = {};\r\n        transactionObject.from = accounts[0];\r\n        transactionObject.to = transferParam.toAccount;\r\n        transactionObject.value = web3.toWei(transferParam.amount,'ether');\r\n        return sendTransaction(transactionObject);\r\n    }\r\n    const contract = await tokenContract();\r\n    return contract.transfer(transferParam.toAccount, web3.toWei(transferParam.amount,'ether'));\r\n}\r\n","import TruffleContract from 'truffle-contract';\r\nimport InstitutionContract from '../contracts/Institution.json';\r\nimport { getProviderAndAccounts } from '../helpers/web3Helpers';\r\n\r\nexport async function institutionContract() {\r\n    const contract = TruffleContract(InstitutionContract);\r\n    const { currentProvider, accounts } = await getProviderAndAccounts();\r\n    contract.setProvider(currentProvider);\r\n    contract.defaults({from: accounts[0]});\r\n    return contract.deployed();\r\n}\r\n\r\nexport async function batchDrawStaticProfit() {\r\n    const contract = await institutionContract();\r\n    return contract.batchDrawStaticProfit();\r\n}\r\n\r\nexport async function releaseScroll(task) {\r\n    const contract = await institutionContract();\r\n    return contract.releaseScroll(task.scrollType, task.id);\r\n}\r\n\r\nexport async function renewScroll(task) {\r\n    const contract = await institutionContract();\r\n    return contract.renewScroll(task.scrollType, task.id);\r\n}\r\n\r\n\r\n","import { promisify } from 'util';\r\nimport { getWeb3 } from \"./getWeb3\";\r\n\r\nexport async function getAccounts() {\r\n    const { eth } = await getWeb3();\r\n    const getAccountsAsync = promisify(eth.getAccounts);\r\n    return getAccountsAsync();\r\n}\r\n\r\nexport async function getBalance() {\r\n    const { eth } = await getWeb3();\r\n    const accounts = await getAccounts();\r\n    const getBalanceAsync = promisify(eth.getBalance);\r\n    return getBalanceAsync(accounts[0]);\r\n}\r\n\r\nexport async function getProviderAndAccounts() {\r\n    const { currentProvider } = await getWeb3();\r\n    const accounts = await getAccounts();\r\n    return {currentProvider, accounts};\r\n}\r\n\r\nexport async function estimateGas(transactionObject) {\r\n    const { eth } = await getWeb3();\r\n    const estimateGasAsync = promisify(eth.estimateGas);\r\n    return estimateGasAsync(transactionObject);\r\n}\r\n\r\nexport async function sendTransaction(transactionObject) {\r\n    const { eth } = await getWeb3();\r\n    const sendTransactionAsync = promisify(eth.sendTransaction);\r\n    return sendTransactionAsync(transactionObject);\r\n}","import Web3 from 'web3'\r\nimport {getLang} from \"@web3game/lang\";\r\n\r\nlet web3Instance = null;\r\n// const thunderTestNetwork = \"18\";\r\n// const thunderMainNetwork = \"108\";\r\n\r\nexport const getWeb3 = async () => {\r\n  if (web3Instance) {  \r\n    return web3Instance;\r\n  }\r\n  const context = (typeof window === 'object') ? window : global;\r\n  var web3Provider;\r\n\r\n  if (context.ethereum) {\r\n    web3Provider = context.ethereum;\r\n\r\n    try {\r\n      // 请求用户账号授权\r\n      await context.ethereum.enable();\r\n    } catch (error) {\r\n      // 用户拒绝了访问\r\n      throw new Error(\"User denied account access.\");\r\n    }\r\n  }\r\n  // 老版 MetaMask\r\n  else if (typeof context.web3 !== 'undefined') {\r\n    web3Provider = context.web3.currentProvider;\r\n    console.log('Injected web3 detected.');\r\n  } else {\r\n    // Fallback to localhost if no web3 injection. We've configured this to\r\n    // use the development console's port by default.\r\n    web3Provider = new Web3.providers.HttpProvider('http://127.0.0.1:8545');\r\n    // throw new Error('No web3 instance injected, using Local web3.');\r\n    throw new Error(getLang().WEB3.NO_WEB3_PROVIDER);\r\n  }\r\n  // throw new Error(web3Provider.isTrust);\r\n  // // const networkVersion = web3Provider.networkVersion;\r\n  // // if(networkVersion !== thunderTestNetwork && networkVersion !== thunderMainNetwork) {\r\n  // //   throw new Error(getLang().WEB3.WRONG_NETWORK);\r\n  // // }\r\n\r\n  web3 = new Web3(web3Provider);\r\n\r\n  web3Instance = web3;\r\n\r\n  return web3;\r\n};\r\n"],"sourceRoot":""}